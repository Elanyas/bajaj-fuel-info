<!DOCTYPE html>
<html lang="am">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GW2Y1BE243"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-GW2Y1BE243');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>የባጃጅ ነዳጅ መረጃ - አስተዳደር ፓነል</title>
    <link rel="stylesheet" href="style.css"> 
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Sans+Ethiopic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* General styling for admin panel */
        body {
            font-family: 'Noto Sans Ethiopic', sans-serif;
            background-color: #2c2c2c; /* Darker background */
            color: #e0e0e0; /* Light text */
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #1e1e1e; /* Dark background for content */
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        h2 {
            color: #00bcd4; /* Accent color */
            border-bottom: 2px solid #00bcd4;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .collection-selection {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #2a2a2a;
            border-radius: 5px;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
            display: flex; /* For alignment of select and button */
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            gap: 15px; /* Space between elements */
        }

        .collection-selection label {
            margin-right: 15px;
            font-weight: bold;
            color: #ffffff;
            cursor: pointer;
        }

        .collection-selection select {
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid #555;
            background-color: #3a3a3a;
            color: #e0e0e0;
            font-size: 1em;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
        }

        .collection-selection .add-button {
            background-color: #28a745; /* Green for add */
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .collection-selection .add-button:hover {
            background-color: #218838;
        }

        .data-display-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-display-table th, .data-display-table td {
            border: 1px solid #444;
            padding: 12px;
            text-align: left;
            word-wrap: break-word; /* For long content */
            max-width: 250px; /* Limit cell width */
        }

        .data-display-table th {
            background-color: #00bcd4;
            color: #1e1e1e;
            font-weight: bold;
        }

        .data-display-table tr:nth-child(even) {
            background-color: #2a2a2a;
        }

        .data-display-table tr:hover {
            background-color: #3a3a3a;
        }

        .action-buttons button {
            background-color: #007bff; /* Blue for default actions */
            color: white;
            border: none;
            padding: 8px 12px;
            margin-right: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .action-buttons button.edit-btn {
            background-color: #4CAF50; /* Green for edit */
        }

        .action-buttons button.delete-btn {
            background-color: #f44336; /* Red for delete */
        }

        .action-buttons button:hover {
            opacity: 0.9;
        }

        .form-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #2a2a2a;
            border-radius: 8px;
        }

        .form-section .input-group {
            margin-bottom: 15px;
        }

        .form-section label {
            display: block;
            margin-bottom: 5px;
            color: #ffffff;
        }

        .form-section input[type="text"],
        .form-section input[type="password"],
        .form-section input[type="number"],
        .form-section textarea,
        .form-section select {
            width: calc(100% - 22px);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #555;
            background-color: #3a3a3a;
            color: #e0e0e0;
            font-size: 1em;
        }

        .form-section .submit-button {
            background-color: #00bcd4;
            color: #1e1e1e;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.2s ease;
        }

        .form-section .submit-button:hover {
            background-color: #0097a7;
        }

        .form-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            display: none; /* Hidden by default */
        }

        .form-message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .form-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .data-display-table th, .data-display-table td {
                padding: 8px;
            }
            .action-buttons button {
                padding: 6px 10px;
                font-size: 0.9em;
            }
            .collection-selection {
                flex-direction: column; /* Stack on small screens */
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <h1><span class="accent-text">የባጃጅ ነዳጅ</span> መረጃ</h1>
        <p>የአስተዳደር ፓነል</p>
        <nav class="sub-nav">
            <a href="data.html">ዋና ገጽ</a>
            <a href="news.html">ዜናዎች</a>
            <a href="sales.html">መሸጫ</a>
            <a href="maintenance.html">እንክብካቤ</a>
            <a href="community_data.html">ልውውጥ</a>
            <a href="fuel_stations.html">በተጠቃሚ የተረጋገጠ የማደያ መረጃ</a>
            <a href="data_entry.html">መረጃ ማስገቢያ(የቀድሞ)</a>
            
            <button id="logoutButton" class="nav-button">መውጫ</button>
        </nav>
    </header>

    <main class="container">
        <section class="collection-selection">
            <h2>የመረጃ ስብስብ ይምረጡ</h2>
            <select id="collectionSelect">
                <option value="communityPosts">የማህበረሰብ ልጥፎች (communityPosts)</option>
                <option value="fuelStations">የማደያ መረጃ (fuelStations)</option>
                <option value="fueldata">የነዳጅ ዋጋ/ሁኔታ (fueldata)</option>
                <option value="fuelowners">የማደያ ባለቤቶች (fuelowners)</option>
                <option value="tipOffs">የጥቁር ገበያ ጥቆማዎች (tipOffs)</option>
                <option value="users">ተጠቃሚዎች (users)</option>
                <option value="banusers">የታገዱ ተጠቃሚዎች (banusers)</option> <option value="falsepost">የተሳሳቱ ልጥፎች (falsepost)</option> </select>
            <button id="addUserButton" class="add-button" style="display: none;">አዲስ ተጠቃሚ ጨምር</button>
        </section>

        <section class="data-display-section">
            <h2 id="dataListTitle">መረጃ ዝርዝር</h2>
            <div id="dataList">
                <p class="loading-message">መረጃ እየተጫነ ነው...</p>
            </div>
        </section>

        <section class="form-section" id="dataEntryFormSection" style="display: none;">
            <h2 id="formTitle">መረጃ አስገባ/አዘምን</h2>
            <form id="dataEntryForm" class="data-form">
                <div id="formFieldsContainer">
                    </div>
                <button type="submit" class="submit-button" id="submitButton">መረጃ አስገባ</button>
                <p id="formMessage" class="form-message"></p>
            </form>
        </section>
    </main>

    <footer class="main-footer">
        <p>&copy; 2025 የባጃጅ ነዳጅ መረጃ. ሁሉም መብቶች የተጠበቁ ናቸው።</p>
        <p>ለአስተዳዳሪዎች ብቻ የተዘጋጀ።</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, getDoc, addDoc, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA-ywRuhanxoEJgR83jwp_-nOkPY4jLOH4",
            authDomain: "elanyas-info.firebaseapp.com",
            projectId: "elanyas-info",
            storageBucket: "elanyas-info.firebasestorage.app",
            messagingSenderId: "769306910360",
            appId: "1:769306910360:web:70988eed5b1da8ffa0faed",
            measurementId: "G-GW2Y1BE243"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // UI Elements
        const collectionSelect = document.getElementById('collectionSelect');
        const dataList = document.getElementById('dataList');
        const dataListTitle = document.getElementById('dataListTitle');
        const dataEntryFormSection = document.getElementById('dataEntryFormSection');
        const dataEntryForm = document.getElementById('dataEntryForm');
        const formTitle = document.getElementById('formTitle');
        const formFieldsContainer = document.getElementById('formFieldsContainer');
        const submitButton = document.getElementById('submitButton');
        const formMessageDisplay = document.getElementById('formMessage');
        const logoutButton = document.getElementById('logoutButton');
        const addUserButton = document.getElementById('addUserButton'); // New button

        let currentCollection = 'communityPosts'; // Default collection
        let editingDocId = null; // To keep track of the document being edited

        // Define which collections are editable (update, view, delete) and which can also have new items added via the form
        // 'fueldata' is now fully editable.
        const editableCollections = ['fueldata', 'fuelowners', 'users', 'communityPosts', 'fuelStations', 'tipOffs', 'banusers', 'falsepost']; // Added new collections
        const addableCollections = ['fueldata', 'fuelowners', 'users', 'communityPosts', 'fuelStations', 'tipOffs', 'banusers', 'falsepost']; // Added new collections


        // Define the specific fields for each editable collection for form generation
        // These fields determine what inputs appear when editing or adding.
        const collectionFields = {
            'fueldata': [
                { id: 'stationName', label: 'የማደያ ስም', type: 'text', required: true },
                { id: 'stationNameEnglish', label: 'Station Name (Eng)', type: 'text', required: false },
                { id: 'dieselQueue', label: 'ናፍጣ ወረፋ', type: 'text', required: false },
                { id: 'dieselStatus', label: 'ናፍጣ ሁኔታ', type: 'select', options: ['አለ', 'አነስተኛ', 'የለም'], required: true },
                { id: 'petrolPrice', label: 'ቤንዚን ዋጋ', type: 'number', required: false },
                { id: 'petrolQueue', label: 'ቤንዚን ወረፋ', type: 'text', required: false },
                { id: 'petrolStatus', label: 'ቤንዚን ሁኔታ', type: 'select', options: ['አለ', 'አነስተኛ', 'የለም'], required: true },
                { id: 'postedBy', label: 'የለጠፈው', type: 'text', required: false, readonly: true }
            ],
            'fuelowners': [
                { id: 'phoneNumber', label: 'ስልክ ቁጥር', type: 'text', required: true },
                { id: 'password', label: 'የይለፍ ቃል', type: 'password', required: true },
                { id: 'stationNameAmh', label: 'የማደያ ስም (አማርኛ)', type: 'text', required: true },
                { id: 'stationNameEng', label: 'Station Name (English)', type: 'text', required: false }
            ],
            'users': [
                { id: 'full_name', label: 'ሙሉ ስም', type: 'text', required: true },
                { id: 'license_plate', label: 'የሰሌዳ ቁጥር', type: 'text', required: false },
                { id: 'phone_number', label: 'ስልክ ቁጥር', type: 'text', required: true },
                { id: 'registered_status', label: 'የተመዘገበ ሁኔታ', type: 'checkbox', required: false }
            ],
            'communityPosts': [
                { id: 'title', label: 'ርዕስ', type: 'text', required: true },
                { id: 'author', label: 'ጸሐፊ', type: 'text', required: true, readonly: true },
                { id: 'content', label: 'ይዘት', type: 'textarea', required: true }
            ],
            'fuelStations': [
                { id: 'stationName', label: 'የማደያ ስም', type: 'text', required: true },
                { id: 'fuelType', label: 'የነዳጅ አይነት', type: 'select', options: ['ቤንዚን', 'ናፍጣ', 'ሁለቱም'], required: true },
                { id: 'fuelStatus', label: 'የነዳጅ ሁኔታ', type: 'select', options: ['አለ', 'አነስተኛ', 'የለም'], required: true },
                { id: 'queueStatus', label: 'የወረፋ ሁኔታ', type: 'select', options: ['የለም', 'አጭር', 'መካከለኛ', 'ረጅም'], required: true },
                { id: 'submittedBy', label: 'የላከው', type: 'text', required: true, readonly: true }
            ],
            'tipOffs': [
                { id: 'location', label: 'ቦታ', type: 'text', required: true },
                { id: 'details', label: 'ዝርዝር', type: 'textarea', required: true },
                { id: 'submittedBy', label: 'የላከው', type: 'text', required: true, readonly: true }
            ],
            // New Collections Added
            'banusers': [
                { id: 'phoneNumber', label: 'ስልክ ቁጥር', type: 'text', required: true },
                { id: 'reason', label: 'ምክንያት', type: 'textarea', required: true },
                { id: 'bannedBy', label: 'ያገደው', type: 'text', required: false, readonly: true }
            ],
            'falsepost': [
                { id: 'originalPostId', label: 'የመጀመሪያው ልጥፍ ID', type: 'text', required: true },
                { id: 'reportedBy', label: 'ያመለከተው', type: 'text', required: true, readonly: true },
                { id: 'reason', label: 'ምክንያት', type: 'textarea', required: true },
                { id: 'status', label: 'ሁኔታ', type: 'select', options: ['ክፍት', 'በሂደት ላይ', 'ተዘግቷል'], required: true }
            ]
        };


        document.addEventListener('DOMContentLoaded', async function() {
            // Authentication is removed as per your last request.
            // This page will now load directly without any login check.
            
            // Logout button functionality (still here, but won't "log out" anything if no login is happening)
            if (logoutButton) {
                logoutButton.addEventListener('click', () => {
                    // Only clear 'isAdminLoggedIn' if it was ever set.
                    // If no login is happening, this button effectively just redirects.
                    localStorage.removeItem('isAdminLoggedIn'); 
                    alert("ወደ መግቢያ ገጽ እየተመለሱ ነው።"); // Change message to reflect current behavior
                    window.location.href = "login.html"; 
                });
            }

            // Initial fetch based on default collection
            await fetchData(currentCollection);
            toggleAddButtonVisibility(); // Show/hide add button on initial load


            // Event listener for collection selection change
            collectionSelect.addEventListener('change', async (event) => {
                currentCollection = event.target.value;
                dataListTitle.textContent = `${collectionSelect.options[collectionSelect.selectedIndex].text} ዝርዝር`;
                await fetchData(currentCollection);
                dataEntryFormSection.style.display = 'none'; // Hide form when changing collection
                editingDocId = null; // Reset editing state
                submitButton.textContent = 'መረጃ አስገባ'; // Reset button text
                formMessageDisplay.style.display = 'none'; // Hide messages
                toggleAddButtonVisibility(); // Update add button visibility
            });

            // Event listener for Add User button (or general Add Item button)
            addUserButton.addEventListener('click', () => {
                editingDocId = null; // Ensure we are in "add new" mode
                dataEntryForm.reset(); // Clear any previous form data
                formTitle.textContent = `አዲስ ${collectionSelect.options[collectionSelect.selectedIndex].text.replace('ዎች', '').replace('መረጃ', '').trim()} አስገባ`; // Dynamically change title
                submitButton.textContent = 'መረጃ አስገባ';
                formMessageDisplay.style.display = 'none';
                dataEntryFormSection.style.display = 'block'; // Show the form
                generateFormFields(currentCollection, {}); // Generate empty fields for new entry
            });

            // Function to control the visibility of the "Add New User" button
            function toggleAddButtonVisibility() {
                if (addableCollections.includes(currentCollection)) { // Check if current collection is addable
                    addUserButton.style.display = 'inline-block'; // Show the button
                    // Change text dynamically based on selected collection
                    let collectionText = collectionSelect.options[collectionSelect.selectedIndex].text;
                    let buttonText = `አዲስ ${collectionText.replace('ዎች', '').replace('መረጃ', '').trim()} ጨምር`;
                    addUserButton.textContent = buttonText;
                } else {
                    addUserButton.style.display = 'none'; // Hide the button
                }
            }


            // Handle form submission
            dataEntryForm.addEventListener('submit', handleFormSubmit);

            // Function to fetch and display data for the selected collection
            async function fetchData(collectionName) {
                dataList.innerHTML = '<p class="loading-message">መረጃ እየተጫነ ነው...</p>';
                try {
                    const q = collection(db, collectionName);
                    const querySnapshot = await getDocs(q);

                    if (querySnapshot.empty) {
                        dataList.innerHTML = `<p class="loading-message">ምንም ${collectionName} መረጃ የለም።</p>`;
                        return;
                    }

                    let tableHtml = '<table class="data-display-table"><thead><tr>';
                    const headers = new Set();
                    const dataRows = [];

                    querySnapshot.forEach((docSnap) => {
                        const data = docSnap.data();
                        data.id = docSnap.id; // Add document ID for actions
                        Object.keys(data).forEach(key => headers.add(key));
                        dataRows.push(data);
                    });

                    // Convert Set to Array and sort headers, put 'id' first if it exists
                    const sortedHeaders = Array.from(headers).sort((a, b) => {
                        if (a === 'id') return -1;
                        if (b === 'id') return 1;
                        return a.localeCompare(b);
                    });

                    sortedHeaders.forEach(header => {
                        tableHtml += `<th>${header}</th>`;
                    });
                    tableHtml += `<th>ድርጊቶች</th></tr></thead><tbody>`;

                    dataRows.forEach(row => {
                        tableHtml += '<tr>';
                        sortedHeaders.forEach(header => {
                            let displayValue = row[header];
                            if (displayValue && typeof displayValue.toDate === 'function') {
                                displayValue = displayValue.toDate().toLocaleString('am-ET', {
                                    year: 'numeric', month: 'short', day: 'numeric',
                                    hour: '2-digit', minute: '2-digit'
                                });
                            } else if (typeof displayValue === 'boolean') {
                                displayValue = displayValue ? 'እውነት' : 'ሀሰት';
                            } else if (displayValue === undefined) {
                                displayValue = 'N/A';
                            }
                            tableHtml += `<td>${displayValue}</td>`;
                        });
                        tableHtml += `<td class="action-buttons">`;
                        
                        // Check if collection is editable or only view/delete
                        if (editableCollections.includes(collectionName)) { 
                            tableHtml += `<button class="edit-btn" data-id="${row.id}" data-collection="${collectionName}">አርትዕ</button>`;
                        }
                        tableHtml += `<button class="delete-btn" data-id="${row.id}" data-collection="${collectionName}">ሰርዝ</button>`;
                        tableHtml += `</td></tr>`;
                    });

                    tableHtml += '</tbody></table>';
                    dataList.innerHTML = tableHtml;

                    // Add event listeners for edit and delete buttons
                    document.querySelectorAll('.edit-btn').forEach(button => {
                        button.addEventListener('click', handleEdit);
                    });
                    document.querySelectorAll('.delete-btn').forEach(button => {
                        button.addEventListener('click', handleDelete);
                    });

                } catch (error) {
                    console.error("Error fetching data: ", error);
                    dataList.innerHTML = `<p class="loading-message" style="color: #f44336;">መረጃውን በመጫን ላይ ስህተት ተፈጥሯል: ${error.message}</p>`;
                }
            }

            // Function to generate form fields based on collection configuration
            function generateFormFields(collectionName, docData = {}) {
                formFieldsContainer.innerHTML = ''; // Clear previous fields
                const fieldsConfig = collectionFields[collectionName]; 

                if (!fieldsConfig) {
                    formFieldsContainer.innerHTML = `<p style="color: #f44336;">ለዚህ ኮሌክሽን የመረጃ ማስገቢያ ቅጽ አልተገለጸም።</p>`;
                    return;
                }

                fieldsConfig.forEach(field => {
                    const div = document.createElement('div');
                    div.className = 'input-group';
                    const label = document.createElement('label');
                    label.htmlFor = field.id;
                    label.textContent = field.label + ':';
                    div.appendChild(label);

                    let inputElement;
                    if (field.type === 'select') {
                        inputElement = document.createElement('select');
                        field.options.forEach(optionText => {
                            const option = document.createElement('option');
                            option.value = optionText;
                            option.textContent = optionText;
                            inputElement.appendChild(option);
                        });
                    } else if (field.type === 'textarea') {
                        inputElement = document.createElement('textarea');
                        inputElement.rows = 4;
                    } else if (field.type === 'checkbox') {
                        inputElement = document.createElement('input');
                        inputElement.type = 'checkbox';
                        inputElement.id = field.id; 
                        // Set initial checked state for checkbox
                        if (docData[field.id] === true) {
                            inputElement.checked = true;
                        }
                    }
                    else {
                        inputElement = document.createElement('input');
                        inputElement.type = field.type;
                    }

                    inputElement.id = field.id;
                    if (field.required) {
                        inputElement.required = true;
                    }
                    if (field.readonly) {
                        inputElement.readOnly = true;
                    }
                    // Populate with current data, handle checkbox separately
                    if (field.type !== 'checkbox') {
                         if (field.type === 'number') {
                             inputElement.value = docData[field.id] !== undefined ? docData[field.id] : '';
                         } else {
                             inputElement.value = docData[field.id] || '';
                         }
                    }
                   
                    div.appendChild(inputElement);
                    formFieldsContainer.appendChild(div);
                });
            }


            // Function to handle Edit button click
            async function handleEdit(event) {
                const docId = event.target.dataset.id;
                const collectionName = event.target.dataset.collection;
                editingDocId = docId; // Set the ID of the document being edited

                dataEntryFormSection.style.display = 'block'; // Show the form section
                formTitle.textContent = `መረጃ አዘምን (${collectionSelect.options[collectionSelect.selectedIndex].text.replace('ዎች', '').trim()})`; // Dynamic title
                submitButton.textContent = 'አዘምን';
                formMessageDisplay.style.display = 'none';

                // Get document data
                const docRef = doc(db, collectionName, docId);
                const docSnap = await getDoc(docRef);

                if (!docSnap.exists()) {
                    showMessage("ሰነዱ አልተገኘም።", "error", formMessageDisplay);
                    return;
                }

                const docData = docSnap.data();
                generateFormFields(collectionName, docData); // Generate and populate fields
            }

            // Function to handle Delete button click
            async function handleDelete(event) {
                const docId = event.target.dataset.id;
                const collectionName = event.target.dataset.collection;

                if (confirm(`በእርግጥ ይህንን መረጃ ከ${collectionName} ይሰርዙ?`)) {
                    try {
                        await deleteDoc(doc(db, currentCollection, docId)); // Use currentCollection for deletion
                        showMessage("መረጃ በተሳካ ሁኔታ ተሰርዟል!", "success", formMessageDisplay);
                        await fetchData(currentCollection); // Refresh data after deletion
                    } catch (error) {
                        console.error("መረጃ ሲሰርዙ ስህተት ተፈጠረ:", error);
                        showMessage(`መረጃውን መሰረዝ አልተቻለም። ስህተት: ${error.message}`, "error", formMessageDisplay);
                    }
                }
            }

            // Handle form submission (add/update)
            async function handleFormSubmit(event) {
                event.preventDefault();
                formMessageDisplay.style.display = 'none';

                const formData = {};
                const fieldsConfig = collectionFields[currentCollection];

                // Gather data from dynamically generated fields
                fieldsConfig.forEach(field => {
                    const inputElement = document.getElementById(field.id);
                    if (inputElement) {
                        if (field.type === 'checkbox') {
                            formData[field.id] = inputElement.checked;
                        } else if (field.type === 'number') {
                            formData[field.id] = parseFloat(inputElement.value);
                        } else {
                            formData[field.id] = inputElement.value.trim();
                        }
                    }
                });

                try {
                    if (editingDocId) {
                        // Update existing document
                        const docRef = doc(db, currentCollection, editingDocId);
                        await updateDoc(docRef, {
                            ...formData
                        });
                        showMessage("መረጃ በተሳካ ሁኔታ ዘምኗል!", "success", formMessageDisplay);
                    } else {
                         // Add new document
                         await addDoc(collection(db, currentCollection), {
                            ...formData,
                            timestamp: serverTimestamp() // Add timestamp for new entries
                        });
                        showMessage("አዲስ መረጃ በተሳካ ሁኔታ ገብቷል!", "success", formMessageDisplay);
                    }

                    dataEntryForm.reset(); // Clear the form
                    editingDocId = null; // Exit editing mode
                    submitButton.textContent = 'መረጃ አስገባ'; // Reset button text
                    dataEntryFormSection.style.display = 'none'; // Hide form after submission
                    await fetchData(currentCollection); // Refresh data
                } catch (error) {
                    console.error("መረጃ ሲያስገቡ/ሲያዘምኑ ስህተት ተፈጠረ:", error);
                    showMessage(`መረጃውን ማስገባት/ማዘመን አልተቻለም። ስህተት: ${error.message}`, "error", formMessageDisplay);
                }
            }

            // Message display function
            function showMessage(message, type, element) {
                element.textContent = message;
                element.className = `form-message ${type}`;
                element.style.display = 'block';
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000); // Hide message after 5 seconds
            }
        });
    </script>
</body>
</html>