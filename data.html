<!DOCTYPE html>
<html lang="am">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GW2Y1BE243"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-GW2Y1BE243');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>рІерЅБрїЃрїЁ ріљрІ│рїЁ рѕўрѕерїЃ - рІІріЊрІЇ рїѕрїй</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Sans+Ethiopic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* рЅ░рїерѕЏрѕф рІе CSS рѕхрЅ│рІГрѕјрЅй рѕѕрЅ░рѕ╗рѕѕ ріарЅђрѕЏрѕўрїЦ - ріерІІріЊрІЇ data.html рі«рЇњ рІерЅ░рІ░рѕерїЅ */
        .fuel-type-details {
            margin-top: 10px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        .fuel-type-details p {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .fuel-type-details strong {
            font-size: 1.1em;
        }
        .status-info p {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .status-info p strong {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="ad-marquee-container">
            <p class="ad-marquee-text">
                Рюе ріарІ▓рѕх рЅБрїЃрїЁ рѕърІ┤рѕјрЅй рЅарЅЁрѕГрЅА рІГрѕўрїБрѕЅ! &nbsp; &nbsp; &nbsp; &nbsp;
                ­ЪњА рѕѕрЅхрѕФріЋрѕхрЇќрѕГрЅх ріарїѕрѕЇрїЇрѕјрЅх рЅБрїЃрїЁ рІГрЇѕрѕЇрїІрѕЅ? &nbsp; &nbsp; &nbsp; &nbsp;
                ­Ъњ░ рІеріљрІ│рїЁ рЅЁріЊрѕй рѕўрѕерїЃ рЅарЅЁрѕГрЅА рІГрЇІ рІГрѕєріЊрѕЇ! &nbsp; &nbsp; &nbsp; &nbsp;
                ­ЪЏа№ИЈ ріарІ▓рѕх рІерїЦрїѕріЊ рѕЮріГрѕ«рЅйріЋ рІГрѕўрѕЇріерЅ▒! &nbsp; &nbsp; &nbsp; &nbsp;
            </p>
        </div>

        <h1><span class="accent-text">рІерЅБрїЃрїЁ ріљрІ│рїЁ</span> рѕўрѕерїЃ</h1>
        <p>рІерЅхріърЅ╣ ріљрІ│рїЁ рѕЏрІ░рІФрІјрЅй ріљрІ│рїЁ ріЦріЋрІ│рѕІрЅИрІЇ ріЦріЊ рІерІѕрѕерЇІ рѕЂріћрЅ│рЅИрІЇріЋ рЅарЅђрѕІрѕЅ рІГрІѕрЅЂ!</p>
        <nav class="sub-nav">
            <a href="news.html">рІюріЊрІјрЅй</a>
            <a href="sales.html">рѕўрѕИрїФ</a>
            <a href="maintenance.html">ріЦріЋріГрЅЦріФрЅц</a>
            <a href="community_data.html">рѕЇрІЇрІЇрїЦ</a>
            <a href="data_entry.html">рѕўрѕерїЃ ріарѕхрїѕрЅБ</a>
            <a href="fuel_stations.html">рЅарЅ░рїарЅЃрѕџ рІерЅ░рѕўрІўрїѕрЅА рІерѕЏрІ░рІФ рѕўрѕерїЃрІјрЅй</a>
        </nav>
    </header>

    <main class="container">
        <section class="fuel-station-list" id="fuelStationList">
            <p id="loadingMessage" style="text-align: center; margin-top: 20px;">рѕўрѕерїЃрІјрЅй ріЦрІерЅ░рїФріЉ ріљрІЇ... ріЦрЅБріГрІј рІГрїарЅЦрЅЂрЇб</p>
            <p id="errorMessage" class="error-message" style="display: none; text-align: center; margin-top: 20px;"></p>
        </section>

        <div style="text-align: center; margin: 30px 0;">
            <button id="logoutButton"
                    style="
                        background-color:#00bcd4; /* ріерѕѕрѕГ */
                        color: white;
                        padding: 10px 100px; /* рѕ░рЇІ рІФрѕѕ padding */
                        border: none;
                        border-radius: 16px;
                        font-size: 1.1em; /* рЅхрѕЇрЅЁ рїйрѕЉрЇЇ */
                        cursor: pointer;
                        transition: background-color 0.3s ease, transform 0.2s ease;
                        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                        width: auto; /* Width auto to fit content */
                        min-width: 150px; /* Minimum width for the button */
                    "
                    onmouseover="this.style.backgroundColor='#d32f2f'; this.style.transform='scale(1.05)';"
                    onmouseout="this.style.backgroundColor='#f44336'; this.style.transform='scale(1)';"
            >рѕўрІЇрїФ</button>
        </div>
    </main>

    <footer class="main-footer">
        <p>&copy; 2025 рІерЅБрїЃрїЁ ріљрІ│рїЁ рѕўрѕерїЃ. рѕЂрѕЅрѕЮ рѕўрЅЦрЅХрЅй рІерЅ░рїарЅарЅЂ ріЊрЅИрІЇрЇб</p>
        <p>рѕѕрІѕрЅЁрЅ│рІі рѕўрѕерїЃ рІхрѕе-рїѕрї╗рЅйріЋріЋ рІГрїјрЅЦріЎрЇб</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA-ywRuhanxoEJgR83jwp_-nOkPY4jLOH4",
            authDomain: "elanyas-info.firebaseapp.com",
            projectId: "elanyas-info",
            storageBucket: "elanyas-info.firebasestorage.app",
            messagingSenderId: "769306910360",
            appId: "1:769306910360:web:70988eed5b1da8ffa0faed",
            measurementId: "G-2XX2B3RSGP"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', async () => {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const loggedInUserName = localStorage.getItem('loggedInUserName');
            const loggedInUserPhone = localStorage.getItem('loggedInUserPhone');
            const loggedInUserLicensePlate = localStorage.getItem('loggedInUserLicensePlate');
            const loggedInUserLastPaymentDate = localStorage.getItem('loggedInUserLastPaymentDate');

            // ріарѕхрЇѕрѕІрїі рІерѕєріЉрЅхріЋ 4 рѕўрѕерїЃрІјрЅй рѕўріќрѕФрЅИрІЇріЋ рІФрѕерїІрїЇрїА
            if (!isLoggedIn || !loggedInUserName || !loggedInUserPhone || !loggedInUserLicensePlate || !loggedInUserLastPaymentDate) {
                alert("рѕѕрѕўрїЇрЅБрЅх рЇЇрЅЃрІх рІерѕѕрІјрЅхрѕЮрЇб ріЦрЅБріГрІј ріЦріЋрІ░рїѕріЊ рІГрїЇрЅАрЇб");
                localStorage.clear(); // рІФрѕЇрЅ░рѕЪрѕІ рѕўрѕерїЃ ріФрѕѕ рѕЂрѕЅріЋрѕЮ рІФрїЦрЇІ
                window.location.href = 'login.html';
                return; // ріерІџрѕЁ рЅарѕІрІГ ріЦріЋрІ│рІГрЅђрїЦрѕЇ
            }

            // рІеріГрЇЇрІФ рЅђріЋ рѕЏрѕерїІрїѕрїЦ
            try {
                const SUBSCRIPTION_DURATION_DAYS = 30; // рІерІ░ріЋрЅаріЮріљрЅх рѕЮрІЮрїѕрЅБрІЇ рІерѕџрЅєрІГрЅарЅх рїірІю рЅа рЅђріЊрЅх
                const lastPaymentDate = new Date(loggedInUserLastPaymentDate);
                const today = new Date();
                const expirationDate = new Date(lastPaymentDate);
                expirationDate.setDate(expirationDate.getDate() + SUBSCRIPTION_DURATION_DAYS);

                // рІеріГрЇЇрІФ рїірІюрІЇ ріарѕЇрЇј ріерѕєріљ рІѕрІ░ login.html рІГрѕўрѕЇрѕх
                if (today > expirationDate) {
                    alert("рІерІ░ріЋрЅаріЮріљрЅх рѕЮрІЮрїѕрЅБ рїірІюрІј ріарѕЇрЅІрѕЇрЇб ріЦрЅБріГрІј рІФрІхрѕ▒рЇб");
                    localStorage.clear(); // рїірІюрІЇ ріФрѕѕрЇѕ рѕЂрѕЅріЋрѕЮ рІФрїЦрЇІ
                    window.location.href = 'login.html';
                    return; // ріерІџрѕЁ рЅарѕІрІГ ріЦріЋрІ│рІГрЅђрїЦрѕЇ
                }
            } catch (error) {
                console.error("рІеріГрЇЇрІФ рЅђріЋ рѕ▓рѕерїІрїѕрїЦ рѕхрѕЁрЅ░рЅх рЅ░рЇѕрїарѕе:", error);
                alert("рІерѕўрїЇрЅБрЅх рЇЇрЅЃрІхрІј рѕірѕерїІрїѕрїЦ ріарѕЇрЅ╗рѕѕрѕЮрЇб ріЦрЅБріГрІј ріЦріЋрІ░рїѕріЊ рІГрїЇрЅАрЇб");
                localStorage.clear();
                window.location.href = 'login.html';
                return;
            }

            const fuelStationList = document.getElementById('fuelStationList');
            const loadingMessage = document.getElementById('loadingMessage');
            const errorMessageDisplay = document.getElementById('errorMessage');

            try {
                // рѕўрѕерїЃрІјрЅйріЋ ріе Firebase Firestore ріарѕЮрїБ
                const q = query(collection(db, "fueldata"), orderBy("stationName", "asc"));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    loadingMessage.style.display = 'none';
                    errorMessageDisplay.textContent = "рѕЮріЋрѕЮ рІеріљрІ│рїЁ рѕЏрІ░рІФ рѕўрѕерїЃ рІерѕѕрѕЮрЇб";
                    errorMessageDisplay.style.display = 'block';
                    return;
                }

                fuelStationList.innerHTML = ''; // рІФрѕЅрЅхріЋ рѕўрѕЇрІЋріГрЅХрЅй ріарїЦрЇІ

                querySnapshot.forEach((doc) => {
                    const station = doc.data();
                    const stationId = doc.id; // рІерѕ░ріљрІ▒ріЋ рѕўрЅ│рІѕрЅѓрІФ ріЦріЋрІГрІЏрѕѕріЋ

                    const lastUpdated = station.lastUpdated ? new Date(station.lastUpdated.toDate()).toLocaleString('am-ET', {
                        year: 'numeric', month: '2-digit', day: '2-digit',
                        hour: '2-digit', minute: '2-digit', hour12: false
                    }) : 'рІФрѕЇрЅ│рІѕрЅђ';

                    const cardHtml = `
                        <div class="station-card">
                            <h2 class="station-name">${station.stationName} | ${station.stationNameEnglish || ''}</h2>
                            <div class="status-info">
                                <div class="fuel-type-details">
                                    <p>рЅцріЋрІџріЋ: <strong class="${station.petrolStatus === 'ріарѕѕ' ? 'available' : 'unavailable'}">${station.petrolStatus}</strong></p>
                                    <p>рІІрїІ: <strong>${station.petrolPrice ? station.petrolPrice + ' рЅЦрѕГ/рѕірЅхрѕГ' : 'рІФрѕЇрЅ│рІѕрЅђ'}</strong></p>
                                    <p>рІерІѕрѕерЇІ рѕЂріћрЅ│: <strong class="status-short">${station.petrolQueue || 'рІФрѕЇрЅ│рІѕрЅђ'}</strong></p>
                                </div>
                                <div class="fuel-type-details">
                                    <p>ріЊрЇЇрїБ: <strong class="${station.dieselStatus === 'ріарѕѕ' ? 'available' : 'unavailable'}">${station.dieselStatus}</strong></p>
                                    <p>рІеріљрІ│рїЁ рІІрїІ: <strong>${station.dieselPrice ? station.dieselPrice + ' рЅЦрѕГ/рѕірЅхрѕГ' : 'рІФрѕЇрЅ│рІѕрЅђ'}</strong></p>
                                    <p>рІерІѕрѕерЇІ рѕЂріћрЅ│: <strong class="status-short">${station.dieselQueue || 'рІФрѕЇрЅ│рІѕрЅђ'}</strong></p>
                                </div>
                            </div>
                            <p class="last-updated">рІерѕўрїерѕерѕ╗ рІЮрѕўріЊ: ${lastUpdated}</p>
                        </div>
                    `;
                    fuelStationList.innerHTML += cardHtml;
                });
            } catch (error) {
                console.error("рѕўрѕерїЃрІјрЅйріЋ ріеFirebase рѕ▓рІФрѕўрїА рѕхрѕЁрЅ░рЅх рЅ░рЇѕрїарѕе:", error);
                loadingMessage.style.display = 'none';
                errorMessageDisplay.textContent = "рѕўрѕерїЃрІјрЅйріЋ рѕЏрѕЮрїБрЅх ріарѕЇрЅ░рЅ╗рѕѕрѕЮрЇб ріЦрЅБріГрІј ріЦріЋрІ░рїѕріЊ рІГрѕъріГрѕЕрЇб";
                errorMessageDisplay.style.display = 'block';
            } finally {
                loadingMessage.style.display = 'none'; // рІерѕўрїФріЏ рѕўрѕЇрІЋріГрЅ▒ріЋ ріарѕхрІѕрїЇрІх
            }

            // рІерѕўрІЇрїФрІЇ рЅарЅ░ріЋ рЅ░рїЇрЅБрѕГ
            const logoutButton = document.getElementById('logoutButton');
            if (logoutButton) {
                logoutButton.addEventListener('click', () => {
                    localStorage.removeItem('isLoggedIn'); // рІерѕўрїЇрЅбрІФ рѕЂріћрЅ│ріЋ ріарїЦрЇІ
                    localStorage.removeItem('loggedInUserName');
                    localStorage.removeItem('loggedInUserPhone');
                    localStorage.removeItem('loggedInUserLicensePlate');
                    localStorage.removeItem('loggedInUserLastPaymentDate');
                    alert("рЅарЅ░рѕ│ріФ рѕЂріћрЅ│ рІѕрїЦрЅ░рІІрѕЇ!");
                    window.location.href = "login.html"; // рІѕрІ░ рѕўрїЇрЅбрІФ рїѕрїй рѕЮрѕФ
                });
            }
        });
    </script>
</body>
</html>