<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>የባጃጅ ነዳጅ መረጃ - መግቢያ</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Ethiopic:wght@400;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GW2Y1BE243"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-GW2Y1BE243');
    </script>
</head>
<body>
    <div class="main-container">
        <div class="login-section">
            <div class="login-form-card">
                <h2 class="form-title">እንኳን ደህና መጡ!</h2>
                <p class="form-subtitle">በስልክ ቁጥርዎ፣ የታርጋ ቁጥርዎ እና በይለፍ ቃልዎ ይግቡ።</p>
                
                <div class="input-group">
                    <label for="phoneNumberInput" class="sr-only">ስልክ ቁጥር:</label>
                    <input type="tel" id="phoneNumberInput" placeholder="ስልክ ቁጥር (ለምሳሌ: 0912345678)" required>
                </div>
                <div class="input-group">
                    <label for="licensePlateInput" class="sr-only">የታርጋ ቁጥር:</label>
                    <input type="text" id="licensePlateInput" placeholder="የታርጋ ቁጥር (ለምሳሌ: 3000 ኮድ3 አአ)" required>
                </div>
                <div class="input-group">
                    <label for="passwordInput" class="sr-only">የይለፍ ቃል:</label>
                    <input type="password" id="passwordInput" placeholder="የይለፍ ቃል ያስገቡ" required>
                </div>
                
                <button id="loginButton">መግቢያ</button>
                
                <p id="errorMessage" class="error-message"></p>
                <p class="register-link">
                    አልተመዘገቡም? <a href="register.html">እዚህ ይመዝገቡ</a>
                </p>
            </div>
        </div>

        <div class="info-container">
            <h2 class="info-title">ለባጃጅ ሹፌሮች ወሳኝ መረጃ!</h2>
            <p>ውድ የባጃጅ ሹፌሮች፣ ይህ ድረ-ገጽ የነዳጅ ማደያዎችን ወቅታዊ መረጃ በቀላሉ እንድታገኙ ታስቦ የተሰራ ነው።
            <strong>የነዳጅ መኖር/አለመኖር </strong>፣ <strong>የነዳጅ ዋጋ </strong> እና<strong> የወረፋ ሁኔታ</strong> መረጃ በእጃችሁ ይገኛል!
            </p>
            <p>በተጨማሪም መሰረታዊ <strong>የባጃጅ ጥገና ምክሮች</strong>፣ <strong>የመንገድ ትራንስፖርት መረጃዎች</strong> እና <strong>ያገለገሉ የባጃጅ ሽያጭ መረጃዎች</strong>  ይለጠፉበታል።</p>

            <div class="info-section">
                <h3 class="section-heading">ይህንን ድረ-ገጽ ለምን መጠቀም አለባችሁ? ዋና ዋና ምክንያቶች:</h3>
                <ul>
                    <li><p><strong>ጊዜ ለመቆጠብ:</strong> ወደ ነዳጅ ማደያ ከመሄድዎ በፊት ሁኔታውን በማየት ወረፋ ያለበትን ወይም ነዳጅ የሌለበትን ቦታ ለማወቅ ይረዳዎታል።</p></li>
                    <li><p><strong>ገንዘብ ለመቆጠብ:</strong> አላስፈላጊ ጉዞዎችን ይቀንሳሉ፣ ይህም ነዳጅዎን እና ጉልበትዎን ይቆጥባል።</p></li>
                    <li><p><strong>በፍጥነት ለመወሰን:</strong> የትኛው ማደያ የተሻለ እንደሆነ ፈጣንና ትክክለኛ ውሳኔ እንዲወስኑ ያስችልዎታል።</p></li>
                </ul>
            </div>

            <div class="info-section">
                <h3 class="section-heading">የአጠቃቀም መመሪያ:</h3>
                <ol>
                    <li><p>በመጀመሪያ፣ ወደ ስልክ ቁጥር <strong>0989750238</strong> በE-birr በቀላሉ <strong>20 ብር</strong> ይክፈሉ።</p></li>
                    <li><p>በመቀጠል፣  የክፍያ ማረጋገጫውን <strong>ስክሪንሾት</strong> ያንሱ። </p></li>
                    <li><p> ከታች ያለውን በተን በመጫን ወደ <span class="telegram-link-text">ቴሌግራም ቦት</span> ለይ ይሂዱ። የሚጠየቁትን መረጃም ይስጡ።</p></li>
                    <li><p>በትክክል መክፈልዎ ከተረጋገጠ በኋላ ቦቱ ፓስወርድ ይሰጥዎታል። <strong>በጥንቃቄ ኮፒ አድርገው ይያዙ!</strong> </p></li>
                    <li><p>ከዚያም በተሰጠዎት ፓስወርድ ይህንን ድረ-ገጽ መጠቀም ይችላሉ።</p></li>
                </ol>
                <div class="telegram-button-container">
                    <a href="https://t.me/elan_payment_bot" target="_blank" class="telegram-button">ቴሌግራም ቦት</a>
                </div>
            </div>
            <p class="important-note"><strong>ለራስዎ ደህንነት ሲሉ፣ የተሰጠዎትን ፓስወርድ ለግልዎ ብቻ እንዲይዙት በጥብቅ እናሳስባለን። ድረ-ገጹን መጠቀሙ ስራዎን ለማቃለል እና ወጪዎን ለመቀነስ እንደሚረዳዎ እርግጠኞች ነን!</strong></p>
        </div>
    </div>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA-ywRuhanxoEJgR83jwp_-nOkPY4jLOH4",
        authDomain: "elanyas-info.firebaseapp.com",
        projectId: "elanyas-info",
        storageBucket: "elanyas-info.firebasestorage.app",
        messagingSenderId: "769306910360",
        appId: "1:769306910360:web:70988eed5b1da8ffa0faed",
        measurementId: "G-2XX2B3RSGP"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const phoneNumberInput = document.getElementById('phoneNumberInput');
    const licensePlateInput = document.getElementById('licensePlateInput');
    const passwordInput = document.getElementById('passwordInput');
    const loginButton = document.getElementById('loginButton');
    const errorMessageDisplay = document.getElementById('errorMessage');

    function showErrorMessage(message) {
        errorMessageDisplay.textContent = message;
        errorMessageDisplay.style.opacity = "1";
    }

    function hideErrorMessage() {
        errorMessageDisplay.style.opacity = "0";
        errorMessageDisplay.textContent = "";
    }

    async function sha256(message) {
        const textEncoder = new TextEncoder();
        const data = textEncoder.encode(message);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hexHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        return hexHash;
    }

    loginButton.addEventListener('click', async () => {
        hideErrorMessage();

        const phoneNumber = phoneNumberInput.value.trim();
        const licensePlate = licensePlateInput.value.trim();
        const password = passwordInput.value;

        if (!phoneNumber || !licensePlate || !password) {
            showErrorMessage("እባክዎ ሁሉንም መስኮች ይሙሉ!");
            return;
        }
        if (!phoneNumber.startsWith('09') || phoneNumber.length !== 10 || !/^\d+$/.test(phoneNumber)) {
            showErrorMessage("ትክክለኛ የኢትዮጵያ ስልክ ቁጥር ያስገቡ (ለምሳሌ: 0912345678)");
            return;
        }

        loginButton.disabled = true;
        showErrorMessage("እየገቡ ነው... እባክዎ ይጠብቁ።");

        try {
            const enteredPasswordHash = await sha256(password);
            const userDocId = `${phoneNumber}-${licensePlate.toUpperCase()}`; // User ID format should match what you save in Firestore
            
            const userDocRef = doc(db, "users", userDocId);
            const userSnapshot = await getDoc(userDocRef);

            if (!userSnapshot.exists()) {
                showErrorMessage("ስልክ ቁጥር ወይም የታርጋ ቁጥር ትክክል አይደለም።");
                loginButton.disabled = false;
                return;
            }

            const userData = userSnapshot.data();
            if (userData.password_hash !== enteredPasswordHash) {
                showErrorMessage("የይለፍ ቃልዎ ትክክል አይደለም።");
                loginButton.disabled = false;
                return;
            }

            // --- ይህንን መስመር እዚህ ጨምር ---
            localStorage.setItem('isLoggedIn', 'true'); // የመግቢያ ሁኔታን በ Local Storage ውስጥ አስቀምጥ
            // -----------------------------
            
            alert("በተሳካ ሁኔታ ገብተዋል!");
            window.location.href = "data.html"; // ወደ ዋናው ገጽ ምራ

        } catch (error) {
            console.error("Error during login:", error);
            showErrorMessage("በመግባት ላይ ችግር ተፈጥሯል። እባክዎ እንደገና ይሞክሩ።");
            loginButton.disabled = false;
        }
    });
</script>
</body>
</html>