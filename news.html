<!DOCTYPE html>
<html lang="am">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GW2Y1BE243"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GW2Y1BE243');
  </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>рІерІхрѕФрІГрЅерѕГ ріљрІ│рїЁ рѕўрѕерїЃ - рІюріЊрІјрЅй</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Sans+Ethiopic:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        const loggedInUserName = localStorage.getItem('loggedInUserName');
        const loggedInUserPhone = localStorage.getItem('loggedInUserPhone');
        const loggedInUserPassword = localStorage.getItem('loggedInUserPassword'); // ріЦрІџрѕЁ рѕІрІГ рІерІГрѕѕрЇЇ рЅЃрѕЅріЋ рѕўріќрѕЕріЋ рІФрѕерїІрїЇрїБрѕЇ
        const loggedInUserLastPaymentDate = localStorage.getItem('loggedInUserLastPaymentDate'); // ISO string format

        // ріарѕхрЇѕрѕІрїі рІерѕєріЉрЅхріЋ 4 рѕўрѕерїЃрІјрЅй (PasswordріЋ рїерѕЮрѕ«) рѕўріќрѕФрЅИрІЇріЋ рІФрѕерїІрїЇрїА
        if (!isLoggedIn || !loggedInUserName || !loggedInUserPhone || !loggedInUserPassword || !loggedInUserLastPaymentDate) {
            alert("рѕѕрѕўрїЇрЅБрЅх рЇЇрЅЃрІх рІерѕѕрІјрЅхрѕЮрЇб ріЦрЅБріГрІј ріЦріЋрІ░рїѕріЊ рІГрїЇрЅАрЇб");
            localStorage.clear(); // рІФрѕЇрЅ░рѕЪрѕІ рѕўрѕерїЃ ріФрѕѕ рѕЂрѕЅріЋрѕЮ рІФрїЦрЇІ
            window.location.href = 'login.html';
            return; // ріерІџрѕЁ рЅарѕІрІГ ріЦріЋрІ│рІГрЅђрїЦрѕЇ
        }

        // рІеріГрЇЇрІФ рЅђріЋ рѕЏрѕерїІрїѕрїЦ
        try {
            const SUBSCRIPTION_DURATION_DAYS = 30; // рІерІ░ріЋрЅаріЮріљрЅх рѕЮрІЮрїѕрЅБрІЇ рІерѕџрЅєрІГрЅарЅх рїірІю рЅа рЅђріЊрЅх
            const lastPaymentDate = new Date(loggedInUserLastPaymentDate);
            const today = new Date();
            const expirationDate = new Date(lastPaymentDate);
            expirationDate.setDate(expirationDate.getDate() + SUBSCRIPTION_DURATION_DAYS);

            // рІеріГрЇЇрІФ рїірІюрІЇ ріарѕЇрЇј ріерѕєріљ рІѕрІ░ login.html рІГрѕўрѕЇрѕх
            if (today > expirationDate) {
                alert("рІерІ░ріЋрЅаріЮріљрЅх рѕЮрІЮрїѕрЅБ рїірІюрІј ріарѕЇрЅІрѕЇрЇб ріЦрЅБріГрІј рІФрІхрѕ▒рЇб");
                localStorage.clear(); // рїірІюрІЇ ріФрѕѕрЇѕ рѕЂрѕЅріЋрѕЮ рІФрїЦрЇІ
                window.location.href = 'login.html';
                return; // ріерІџрѕЁ рЅарѕІрІГ ріЦріЋрІ│рІГрЅђрїЦрѕЇ
            }
        } catch (error) {
            console.error("рІеріГрЇЇрІФ рЅђріЋ рѕ▓рѕерїІрїѕрїЦ рѕхрѕЁрЅ░рЅх рЅ░рЇѕрїарѕе:", error);
            alert("рІерѕўрїЇрЅБрЅх рЇЇрЅЃрІхрІј рѕірѕерїІрїѕрїЦ ріарѕЇрЅ╗рѕѕрѕЮрЇб ріЦрЅБріГрІј ріЦріЋрІ░рїѕріЊ рІГрїЇрЅАрЇб");
            localStorage.clear();
            window.location.href = 'login.html';
            return;
        }

        // рѕўрѕерїЃрІЇ рѕЎрѕЅ ріерѕєріљ ріЦріЊ рїірІюрІЇ ріФрѕІрѕѕрЇѕ, postAuthor input ріФрѕѕ рІГрѕЎрѕІрІЇ
        const postAuthorInput = document.getElementById('postAuthor');
        if (postAuthorInput) {
            postAuthorInput.value = loggedInUserName;
        }
    });
</script>
</head>
<body>
    <header class="main-header">
     <div class="menu-container"> <button class="menu-btn" onclick="toggleMenu()">Рў░</button> <nav id="dropdown-menu" class="dropdown-content"> <a href="data.html">рІІріЊрІЇ рїѕрїй</a>  <a href="stations_fuel_data.html">рІерЅ░рѕерїІрїѕрїа рІерѕЏрІ░рІФрІјрЅй рѕўрѕерїЃ</a> 
      <a href="news.html">рІюріЊрІјрЅй</a> <a href="maintenance.html">ріЦріЋріГрЅЦріФрЅц</a> <a href="data_entry.html">рѕўрѕерїЃ рѕЏрѕхрїѕрЅбрІФ</a> <a href="combined_community_data.html">рѕЇрІЇрІЇрїЦ</a> </nav> </div>
      <div class="ad-marquee-container">
        <p class="ad-marquee-text">
            Рюе  рІеріљрЇЃ рѕЮрІЮрїѕрЅБ рїђрѕЮрѕеріЊрѕЇ! &nbsp; &nbsp; &nbsp; &nbsp;
            ­ЪњА рІГрѕЁріЋріЋ ріЦрІхрѕЇ рѕѕрѕїрѕјрЅй рѕ╣рЇїрѕГ рїЊрІ░ріърЅйрІј ріарѕ│рІјрЅђрІІрѕЇ? &nbsp; &nbsp; &nbsp; &nbsp;
            ­Ъњ░ рІГрѕЁріЋріЋ рѕ░рЇі рІерѕўрїѕріЊріЏ рѕўрІхрѕеріГ ріЦріЊ рІерѕўрѕерїЃ рѕЮріЋрїГ рѕѕрѕїрѕјрЅй рїЊрІ░ріърЅЙрѕЮ рІФрѕхрЅ░рІІрІЇрЅЂ! &nbsp; &nbsp; &nbsp; &nbsp;
            ­ЪЏа№ИЈ рІеріарїѕрѕЇрїЇрѕјрЅ│рЅйріЋ рЅ░рїарЅЃрѕџ рѕхрѕѕрѕєріЉ ріЦріЊрѕўрѕ░рїЇріЊрѕѕріЋ! &nbsp; &nbsp; &nbsp; &nbsp;
        </p>
      </div>

      <h1><span class="accent-text">рІерІхрѕФрІГрЅерѕГ ріљрІ│рїЁ</span> рѕўрѕерїЃ</h1>
      <p>рІерЅхріърЅ╣ ріљрІ│рїЁ рѕЏрІ░рІФрІјрЅй ріљрІ│рїЁ ріЦріЋрІ│рѕІрЅИрІЇ ріЦріЊ рІерІѕрѕерЇІ рѕЂріћрЅ│рЅИрІЇріЋ рЅарЅђрѕІрѕЅ рІГрІѕрЅЂ!</p>
      
    </header>

    <main class="container">
        
      <section class="news-container">
            
            
            <div class="news-feed" id="newsFeed">
                <p style="text-align: center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> рІюріЊрІјрЅйріЋ рЅарѕўрїФріЋ рѕІрІГ...</p>
                <div class="banner-ad professional-look" id="adBannerTemplate" style="display: none;">
                    <img src="https://via.placeholder.com/400x300?text=Fuel+Info+Ad" alt="Ad Banner" class="banner-image">
                    <div class="banner-text">
                        <h3>рІеріљрІ│рїЁ рѕўрѕерїЃ рІГрЇѕрѕЇрїІрѕЅ?</h3>
                        <p>рІерЅхріърЅ╣ ріљрІ│рїЁ рѕЏрІ░рІФрІјрЅй ріљрІ│рїЁ ріЦріЋрІ│рѕІрЅИрІЇ ріЦріЊ рІерІѕрѕерЇІ рѕЂріћрЅ│рЅИрІЇріЋ рѕѕрѕўрѕўрѕЇріерЅх рІІріЊрІЇріЋ рїѕрїй рІГрїјрЅЦріЎ!</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <p>&copy; 2025 рІерІхрѕФрІГрЅерѕГ ріљрІ│рїЁ рѕўрѕерїЃ. рѕЂрѕЅрѕЮ рѕўрЅЦрЅХрЅй рІерЅ░рїарЅарЅЂ ріЊрЅИрІЇрЇб</p>
        <p>рѕѕрІѕрЅЁрЅ│рІі рѕўрѕерїЃ рІхрѕе-рїѕрї╗рЅйріЋріЋ рІГрїјрЅЦріЎрЇб</p>
    </footer>

    <script>
        document.querySelectorAll('.news-article-card details').forEach(detail => {
            detail.addEventListener('toggle', () => {
                if (detail.open) {
                    detail.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            });
        });
    </script>
    <script src="main.js"></script>

    <script src="https://kit.fontawesome.com/your-font-awesome-kit.js" crossorigin="anonymous"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            query,
            orderBy,
            getDocs,
        } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

        // ======================================================================
        // 1. Firebase Configs (ріеadmin_logic.js рІерЅ░рІѕрѕ░рІ░)
        // ======================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyA-ywRuhanxoEJgR83jwp_-nOkPY4jLOH4",
            authDomain: "elanyas-info.firebaseapp.com",
            projectId: "elanyas-info",
            storageBucket: "elanyas-info.firebasestorage.app",
            messagingSenderId: "769306910360",
            appId: "1:769306910360:web:70988eed5b1da8ffa0faed",
            measurementId: "G-2XX2B3RSGP"
        };
        const NEWS_COLLECTION = "news";

        // Firebase App ріЦріЊ Firestore Database рѕЏрѕхрїђрѕўрѕГ
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app); 
        
        // DOM Elements
        const newsFeed = document.getElementById('newsFeed');
        const adBannerTemplate = document.getElementById('adBannerTemplate');
        const adBannerHTML = adBannerTemplate ? adBannerTemplate.outerHTML.replace('display: none;', '') : ''; // рІерЅБріљрѕГ HTML

        // ======================================================================
        // 2. рІерїірІю рѕхрѕїрЅх рЅ░рїЇрЅБрѕГ (ріеadmin_logic.js рІерЅ░рІѕрѕ░рІ░)
        // ======================================================================
        function timeAgo(timestamp) {
            if (!timestamp || !timestamp.toDate) {
                return "рЅарЅЁрѕГрЅА рЅ░рѕѕрїарЇѕ";
            }

            const now = new Date();
            const past = timestamp.toDate();
            const seconds = Math.floor((now - past) / 1000);

            // рІерїірІю рѕхрѕїрЅх
            let interval = seconds / 31536000;
            if (interval > 1) {
                return Math.floor(interval) + " рІЊрѕўрЅх рЅарЇірЅх";
            }
            interval = seconds / 2592000;
            if (interval > 1) {
                return Math.floor(interval) + " рІѕрѕГ рЅарЇірЅх";
            }
            interval = seconds / 86400;
            if (interval > 1) {
                return Math.floor(interval) + " рЅђріЋ рЅарЇірЅх";
            }
            interval = seconds / 3600;
            if (interval > 1) {
                return Math.floor(interval) + " рѕ░рІЊрЅх рЅарЇірЅх";
            }
            interval = seconds / 60;
            if (interval > 1) {
                return Math.floor(interval) + " рІ░рЅѓрЅЃ рЅарЇірЅх";
            }
            return "ріарѕЂріЋ рЅ░рѕѕрїарЇѕ";
        }


        // ======================================================================
        // 3. рІюріЊрІјрЅйріЋ ріерЇІрІерѕГрЅцрІЮ рїФріЋ ріЦріЊ ріарЅЁрѕГрЅЦ
        // ======================================================================
        async function fetchAndRenderNews() {
            // рѕўрїФріЋ (Loading) рѕўрѕЇрІЋріГрЅ▒ріЋ ріарѕхрЅђрІхрѕЮ
            newsFeed.innerHTML = '<p style="text-align: center; padding: 20px;"><i class="fas fa-spinner fa-spin"></i> рІюріЊрІјрЅйріЋ рЅарѕўрїФріЋ рѕІрІГ...</p>';
            
            try {
                // рЅарїірІю (timestamp) ріарІ▓рѕх рІерѕєріЉрЅх рЅђрІхрѕўрІЇ ріЦріЋрІ▓рѕўрїА рѕўрїарІГрЅЁ
                const q = query(collection(db, NEWS_COLLECTION), orderBy("timestamp", "desc")); 
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    newsFeed.innerHTML = '<p style="text-align: center;">рїѕріЊ рѕЮріЋрѕЮ рІюріЊ ріарѕЇрЅ░рѕѕрїарЇѕрѕЮрЇб</p>';
                    return;
                }

                let finalHtml = '';
                let newsCounter = 0;
                
                querySnapshot.forEach(doc => {
                    const news = doc.data();
                    const postedTime = timeAgo(news.timestamp);
                    const fullContentHtml = news.content ? news.content.replace(/\n/g, '<br>') : ''; // ріарІ▓рѕх рѕўрѕхрѕўрѕГріЋ рІѕрІ░ <br> рѕѕрІЇрїЦ
                    
                    const newsCard = `
                        <div class="news-article-card">
                            <img src="${news.imageUrl}" alt="${news.title}" class="news-image">
                            <div class="article-content">
                                <details>
                                    <summary>
                                        <h3 class="article-title">${news.title}</h3>
                                        <p class="article-date" style="color: #bbb; font-size: 0.9em;"><i class="far fa-clock"></i> ${postedTime}</p>
                                        <p class="article-summary">${news.summary}</p>
                                    </summary>
                                    <div class="full-content">
                                        <p>${fullContentHtml}</p>
                                    </div>
                                </details>
                            </div>
                        </div>
                    `;

                    finalHtml += newsCard;
                    newsCounter++;

                    // ріерѕЂрѕѕрЅ░ріЏрІЇ рІюріЊ рЅаріІрѕІ (newsCounter === 2) рѕЏрѕхрЅ│рІѕрЅѓрІФрІЇріЋ ріарѕхрїѕрЅБ
                    if (newsCounter === 2 && adBannerHTML) { 
                        finalHtml += adBannerHTML;
                    }
                });

                // рІерЅ░рїФріЉрЅхріЋ рІюріЊрІјрЅй ріЦріЊ рѕЏрѕхрЅ│рІѕрЅѓрІФрІЇріЋ рЅаnewsFeed рІЇрѕхрїЦ ріарѕхрїѕрЅБ
                newsFeed.innerHTML = finalHtml; 
                
                // рІеdetails toggle listener ріЋ ріЦріЋрІ░рїѕріЊ рѕхрѕФ
                document.querySelectorAll('.news-article-card details').forEach(detail => {
                    detail.addEventListener('toggle', () => {
                        if (detail.open) {
                            detail.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }
                    });
                });

            } catch (error) {
                console.error("Error fetching news: ", error);
                newsFeed.innerHTML = '<p style="text-align: center; color: red;">рІюріЊрІјрЅйріЋ рѕѕрѕўрїФріЋ ріарѕЇрЅ░рЅ╗рѕѕрѕЮрЇб</p>';
            }
        }
        
        // рїѕрї╣ рѕ▓рїФріЋ рІюріЊрІјрЅйріЋ рѕўрїФріЋ рїђрѕЮрѕГ
        document.addEventListener('DOMContentLoaded', fetchAndRenderNews);
    </script>
</body>
</html>