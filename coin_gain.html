<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·äÆ·ã≠·äï ·â†·äê·åª ·ã´·åç·äô - ·àê·à®·à≠ ·åà·â†·ã´</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <style>
        :root {
            --bg-color: #0b0e14;
            --card-bg: #161b22;
            --cyan-primary: #00f2ff;
            --cyan-glow: rgba(0, 242, 255, 0.3);
            --text-main: #ffffff;
            --text-dim: #8b949e;
            --success: #22c55e;
            --error: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 450px;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), 0 0 15px var(--cyan-glow);
            border: 1px solid rgba(0, 242, 255, 0.1);
            text-align: center;
        }

        .header h1 {
            color: var(--cyan-primary);
            font-size: 1.5rem;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .balance-badge {
            background: rgba(0, 242, 255, 0.1);
            padding: 10px 20px;
            border-radius: 50px;
            display: inline-block;
            margin: 20px 0;
            border: 1px solid var(--cyan-primary);
            font-weight: bold;
        }

        #coinCount { color: var(--cyan-primary); }

        .quiz-box {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .question {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 20px;
            display: block;
            color: var(--text-main);
        }

        .answer-input {
            width: 100%;
            background: #0d1117;
            border: 2px solid #30363d;
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-size: 1.3rem;
            text-align: center;
            outline: none;
            margin-bottom: 15px;
        }

        .answer-input:focus { border-color: var(--cyan-primary); }

        .submit-btn {
            width: 100%;
            background: var(--cyan-primary);
            color: #000;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .submit-btn:disabled { background: #555; cursor: not-allowed; }

        .feedback { margin-top: 15px; font-weight: bold; min-height: 24px; }
        .correct { color: var(--success); }
        .wrong { color: var(--error); }

        .coming-soon {
            margin-top: 30px;
            padding: 15px;
            border-top: 1px solid #333;
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #000;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto;
        }

        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>·àê·à®·à≠ ·åà·â†·ã´</h1>
        <p id="userStatus" style="color: var(--text-dim); font-size: 0.8rem;">·â†·àò·å´·äï ·àã·ã≠...</p>
    </div>

    <div class="balance-badge">
        ·ã®·ä•·à≠·àµ·ãé ·â£·àã·äï·àµ: <span id="coinCount">0.00</span> DS
    </div>

    <div class="quiz-box">
        <span class="question" id="questionText">--</span>
        <input type="number" id="answerInput" class="answer-input" placeholder="?" autofocus>
        <button id="submitBtn" class="submit-btn" onclick="checkAnswer()">
            <span id="btnText">·àò·àç·àµ ·àã·ä≠</span>
            <div id="spinner" class="loading-spinner"></div>
        </button>
        <div id="feedback" class="feedback"></div>
    </div>

    <div class="coming-soon">
        <p>üöÄ <b>Coming Soon:</b> ·ã®·â™·ã≤·ãÆ ·àõ·àµ·â≥·ãà·âÇ·ã´·ãé·âΩ·äï ·â†·àõ·ã®·âµ ·â∞·å®·àõ·à™ ·äÆ·ã≠·äï ·àõ·åç·äò·âµ ·ã®·àö·âΩ·àâ·â†·âµ ·ä†·åà·àç·åç·àé·âµ ·â†·âÖ·à≠·â° ·ã≠·å†·â•·âÅ!</p>
    </div>
</div>

<script>
    // 1. Firebase Config (·ä®·â∞·à∞·å†·äù ·çã·ã≠·àç ·ã®·â∞·ãà·à∞·ã∞)
    const firebaseConfig = {
        apiKey: "AIzaSyA-ywRuhanxoEJgR83jwp_-nOkPY4jLOH4",
        authDomain: "elanyas-info.firebaseapp.com",
        projectId: "elanyas-info",
        storageBucket: "elanyas-info.firebasestorage.app",
        messagingSenderId: "769306910360",
        appId: "1:769306910360:web:70988eed5b1da8ffa0faed"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const loggedInUserPhone = localStorage.getItem('loggedInUserPhone');
    let currentAnswer;
    let isProcessing = false;

    // 2. ·ã®·â∞·å†·âÉ·àö·ãç·äï ·â£·àã·äï·àµ ·â†·à™·àç-·â≥·ã≠·àù ·àò·ä®·â≥·â∞·àç
    function initApp() {
        if (!loggedInUserPhone) {
            document.getElementById('userStatus').innerText = "·ä•·â£·ä≠·ãé ·àò·åÄ·àò·à™·ã´ ·ã≠·åç·â° (Login)!";
            document.getElementById('submitBtn').disabled = true;
            return;
        }

        document.getElementById('userStatus').innerText = `·à∞·àã·àù ${localStorage.getItem('loggedInUserName') || '·â∞·å†·âÉ·àö'} üëã`;

        db.collection("HararGebeyaUsers").doc(loggedInUserPhone)
        .onSnapshot((doc) => {
            if (doc.exists) {
                const balance = doc.data().ds_coin_balance || 0;
                document.getElementById('coinCount').innerText = balance.toFixed(2);
            }
        });

        generateQuestion();
    }

    function generateQuestion() {
        const n1 = Math.floor(Math.random() * 15) + 1;
        const n2 = Math.floor(Math.random() * 15) + 1;
        const ops = ['+', '-'];
        const op = ops[Math.floor(Math.random() * ops.length)];

        if (op === '+') {
            currentAnswer = n1 + n2;
            document.getElementById('questionText').innerText = `${n1} + ${n2}`;
        } else {
            const max = Math.max(n1, n2);
            const min = Math.min(n1, n2);
            currentAnswer = max - min;
            document.getElementById('questionText').innerText = `${max} - ${min}`;
        }
        document.getElementById('answerInput').value = '';
    }

    async function checkAnswer() {
        if (isProcessing) return;
        
        const userInput = parseInt(document.getElementById('answerInput').value);
        const feedback = document.getElementById('feedback');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const spinner = document.getElementById('spinner');

        if (isNaN(userInput)) return;

        if (userInput === currentAnswer) {
            try {
                isProcessing = true;
                submitBtn.disabled = true;
                btnText.style.display = 'none';
                spinner.style.display = 'block';

                // Firebase ·ãç·àµ·å• ·â£·àã·äï·àµ ·àò·å®·àò·à≠ (+2.00 DS)
                await db.collection("HararGebeyaUsers").doc(loggedInUserPhone).update({
                    ds_coin_balance: firebase.firestore.FieldValue.increment(2.00)
                });

                feedback.innerText = "·âµ·ä≠·ä≠·àç! +2.00 DS ·â∞·å®·àù·àØ·àç ‚úÖ";
                feedback.className = "feedback correct";
                
                setTimeout(() => {
                    generateQuestion();
                    isProcessing = false;
                    submitBtn.disabled = false;
                    btnText.style.display = 'block';
                    spinner.style.display = 'none';
                    feedback.innerText = "";
                }, 1500);

            } catch (error) {
                console.error(error);
                feedback.innerText = "·àµ·àÖ·â∞·âµ ·â∞·çà·å•·àØ·àç! ·ä•·â£·ä≠·ãé ·ä¢·äï·â∞·à≠·äî·âµ·ãé·äï ·ã´·à®·åã·åç·å°·ç¢";
                feedback.className = "feedback wrong";
                isProcessing = false;
                submitBtn.disabled = false;
            }
        } else {
            feedback.innerText = "·àò·àç·à± ·àµ·àÖ·â∞·âµ ·äê·ãç ‚ùå ·ä•·äï·ã∞·åà·äì ·ã≠·àû·ä≠·à©!";
            feedback.className = "feedback wrong";
        }
    }

    // Enter key support
    document.getElementById('answerInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') checkAnswer();
    });

    window.onload = initApp;
</script>

</body>
</html>